from scapy.sendrecv import sr, sr1
from scapy.layers.inet import IP, ICMP


class Tasks:

    @staticmethod
    def icmp_ping(dest_ip, icmp_file_path='icmp.dat'):
        """
        Ping an IP range and collect IP addresses of the hosts that are alive and save the result in icmp.dat.
        """
        ans, unans = sr(IP(dst=dest_ip) / ICMP(), timeout=2)

        alive_host_ips = [packet.src for packet in ans]  # TODO: Check if packet.src or packet.dst is correct

        with open(icmp_file_path, mode='w', encoding='utf8') as output_file:
            output_file.write(';'.join(alive_host_ips))

    @staticmethod
    def port_identification(icmp_file_path='icmp.dat'):
        """
        1) Get the IP addresses from the icmp.dat file and scan and validate these IP addresses.
        If an IP address is a valid live host address append it to a string or list (live hosts) that will contain the
        IP addresses of the live hosts. A live host is an active host that can be monitored by nmap or Wireshark.

        2) Now perform port scan on the live hosts. The scanning must find and identify ports on each host and save the
        results in openPorts.dat. This text file will contain Host IPs, ports numbers, and service/application names
        (if any) of each port.
        """
        with open(icmp_file_path, mode='r', encoding='utf8') as input_file:
            ip_addresses = input_file.read().split(';')

        # TODO: Scan (?) (ping again maybe?) the IPs in ip_addresses.

    @staticmethod
    def os_fingerprint_identification():
        """
        This function will get the host IPs from the text file (openPorts.dat) and identify operating systems (OS) and
        OS versions of the hosts.
        """

    @staticmethod
    def web_server_detection():
        """
        Scan the Internet and discover 10 web-server addresses, protocols, and ports of each web server.
        Save the results in web.dat.
        """

    @staticmethod
    def syn_flood():
        """
        This function will launch SYN-flood attack to a given destination (IP) and port(s).
        This tool must also enable you to choose the number of flooding, e.g., 10.000 SYN attacks.
        While running the SYN-flood attack use some Python codes to capture and decode TCP and IP packet headers and
        save them in SYNresults.txt. If you want, you can also use Wireshark or tcpdump to capture the attack packets
        and save the packets to a pcap file. Thereafter, use a Python code to decode and save the results.
        """

    @staticmethod
    def show():
        """
        This function will ask and display the contents of the files that your tools have created so far.
        """


if __name__ == '__main__':
    Tasks.icmp_ping('127.0.0.1')
